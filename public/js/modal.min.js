document.addEventListener("click",function(event){const target=event.target;if(target.classList.contains("askForPrice")){const productId=target.dataset.id;fetch(`/modal/property/${productId}`,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(response=>{if(!response.ok)throw new Error("Network response was not ok");return response.text()}).then(html=>{const modalHandler=document.getElementById("modalHandler");modalHandler.innerHTML=html;const modalEl=document.getElementById("discountModal");const modal=new bootstrap.Modal(modalEl);modal.show();initializeValidation();initializeRecaptcha();const sendBtn=modalEl.querySelector("#discountSendBtn");if(sendBtn){sendBtn.addEventListener("click",e=>{e.preventDefault();const isValid=$(".validateForm").validationEngine("validate");if(!isValid){return}if(typeof grecaptcha!=="undefined"&&grecaptcha.ready){grecaptcha.ready(()=>{grecaptcha.execute(site_key,{action:"submitContact"}).then(token=>{const form=document.getElementById("modalForm");const formData=new FormData(form);formData.append("recaptcha_token",token);const propertyId=form.getAttribute("data-property");const url=`/modal/property/${propertyId}`;fetch(url,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:formData}).then(response=>{if(!response.ok)throw new Error("HTTP "+response.status);return response.json()}).then(data=>{if(data.success){form.innerHTML=`<div><h3 class="text-success">Dziękujemy za wiadomość!</h3><p>Jesteś już o krok bliżej do swojego zakupu!</p><p>Postaramy się odpowiedzieć tak szybko jak to możliwe.</p><p>Jesteśmy w kontakcie.</p></div>`}else{alert(data.message||"Wystąpił błąd. Spróbuj ponownie.");grecaptcha.reset()}}).catch(err=>{alert("Nie udało się wysłać wiadomości.");grecaptcha.reset()})}).catch(err=>{})})}else{}})}modalEl.addEventListener("hidden.bs.modal",()=>{modalHandler.innerHTML=""})}).catch(error=>{alert("Coś poszło nie tak przy ładowaniu modala!")})}});function initializeValidation(){$(".validateForm").validationEngine({validateNonVisibleFields:true,updatePromptsPosition:true,promptPosition:"topRight:-137px",autoPositionUpdate:false})}function initializeRecaptcha(){if(typeof grecaptcha!=="undefined"&&grecaptcha.ready){grecaptcha.ready(()=>{})}else{}}